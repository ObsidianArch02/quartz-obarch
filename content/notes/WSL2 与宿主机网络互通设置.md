> 参考
> [wsl2-ubuntu 通过 win10 代理连接互联网 - 知乎](https://zhuanlan.zhihu.com/p/382939467)
> [记录一次 WSL2 的网络代理配置 | jiayaoO3O's Blog](https://jiayaoo3o.github.io/2020/06/23/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1WSL2%E7%9A%84%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE/)

默认情况下，Windows 的防火墙会阻止 WSL2 子系统向宿主机的通信，需要在“高级安全 Windows Defender 防火墙”中设置入站规则。

运行`ip route`查看 WSL2 与宿主机的 IP 信息，以及需要配置的子网信息。

另外：

在 Win10 -> WSL2 这个方向, 是可以直接通过 Localhost 来访问的, 但是 WSL2 -> Win10 这个方向就不能直接访问 Localhost 了, 需要指定 Win10 的 ip, 想要查看 WSL2 中 Win10 的 ip, 只需要查看`resolve.conf` :

```sh
cat /etc/resolv.conf

# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.18.176.1
```

这个 172.18.176.1 就是在 WSL2 中 Win10 的 ip.

想要方便获取这个 IP, 可以直接使用下方命令 :

```sh
cat /etc/resolv.conf|grep nameserver|awk '{print $2}'
```

如要使用部署在宿主机上的代理服务，需要打开 Windows 针对代理服务的防火墙设置。

并修改`~/.bashrc`文件：

```sh
host_ip=$(cat /etc/resolv.conf |grep "nameserver" |cut -f 2 -d " ")
export ALL_PROXY="socks5://$host_ip:7890"
export all_proxy="socks5://$host_ip:7890"
export https_proxy="socks5://$host_ip:7890"
export http_proxy="http://$host_ip:7890"
```

然后重载：

```sh
source ~/.bashrc
```

或者使用脚本：

```sh
#!/bin/sh
hostip=$(cat /etc/resolv.conf | grep nameserver | awk '{ print $2 }')
#wslip=$(hostname -I | awk '{print $1}')
port=<PORT>

PROXY_HTTP="http://${hostip}:${port}"

set_proxy(){
    export http_proxy="${PROXY_HTTP}"
    export HTTP_PROXY="${PROXY_HTTP}"

    export https_proxy="${PROXY_HTTP}"
    export HTTPS_proxy="${PROXY_HTTP}"
}

unset_proxy(){
    unset http_proxy
    unset HTTP_PROXY
    unset https_proxy
    unset HTTPS_PROXY
}

test_setting(){
    echo "Host ip:" ${hostip}
    #echo "WSL ip:" ${wslip}
    echo "Current proxy:" $https_proxy
}

if [ "$1" = "set" ]
then
    set_proxy

elif [ "$1" = "unset" ]
then
    unset_proxy

elif [ "$1" = "test" ]
then
    test_setting
else
    echo "Unsupported arguments."
fi
```

另外可以在`~/.bashrc`中选择性的加上下面两句话，记得**将里面的路径修改成你放这个脚本的路径**。

```sh
alias proxy="source /path/to/proxy.sh"
. /path/to/proxy.sh set
```

第一句话可以为这个脚本设置别名`proxy`，这样在任何路径下都可以通过`proxy`命令使用这个脚本了，之后在任何路径下，都可以随时都可以通过输入`proxy unset`来暂时取消代理。第二句话就是在每次 shell 启动的时候运行该脚本实现自动设置代理，这样以后不用额外操作就默认设置好代理啦~

参见：[WSL2 中访问宿主机 Windows 的代理 - ZingLix Blog](https://zinglix.xyz/2020/04/18/wsl2-proxy/)
